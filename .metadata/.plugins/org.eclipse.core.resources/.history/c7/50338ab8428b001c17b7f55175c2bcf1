/*
 * servo.c
 *
 *  Created on: 10 Feb 2022
 *      Author: stein
 */
#include <avr/io.h>
#include <avr/interrupt.h>
#include "serial.h"
#include "servo.h"


void servo1_init(){
	DDRD |= (1<<PORTD6);
	TCCR0A|=(1<<COM0A1)| (1<<WGM00)|(1<<WGM01);

	TIMSK0 |= (1<<TOIE0);

	OCR0A = (servoduty1/100.0)*255;

	TCCR0B|=(1<<CS00);
}

void servo2_init(){
	DDRD |= (1<<PORTD5);
	TCCR0A|=(1<<COM0A1)| (1<<WGM00)|(1<<WGM01);

	TIMSK0 |= (1<<TOIE0);

	OCR0B = (servoduty2/100.0)*255;

	sei();

	TCCR0B|=(1<<CS00);
}

ISR(TIMER0_OVF_vect){
	OCR0A = (servoduty1/100.0)*255;
	OCR0B = (servoduty2/100.0)*255;
}

void setservocycle(char data){
	if((data &= 0x40) == 0x40){
		if((data<=0x32)&&(data>=0)){
		servoduty1=(data &= 0x3F);}
		else{

			servoduty1=0x32;
		}
	}
	if((data<=0x32)&&(data>=0)){
			servoduty2=(data &= 0x3F);}
			else{

				servoduty2=0x32;
			}
}

void setdccommand(char command){
	dccommand= command;
}

